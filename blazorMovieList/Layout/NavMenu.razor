@using Blazored.LocalStorage
@inject NavigationManager NavigationManager
@inject ILocalStorageService localStorage

<nav class="navbar navbar-expand-lg navbar-dark bg-dark px-3">
    <a class="navbar-brand" href="/">blazorMovieList</a>

    <button class="navbar-toggler" type="button" @onclick="ToggleNavMenu">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse @(collapseNavMenu ? "" : "show")">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">

            <li class="nav-item px-2">
                <NavLink class="nav-link" href="/" Match="NavLinkMatch.All">
                    Home
                </NavLink>
            </li>

            <li class="nav-item px-2">
                <NavLink class="nav-link" href="counter">
                    Counter
                </NavLink>
            </li>

            <li class="nav-item px-2">
                <NavLink class="nav-link" href="weather">
                    Weather
                </NavLink>
            </li>
        </ul>

        <ul class="navbar-nav">
            @if (isLoggedIn)
            {
                <li class="nav-item">
                    <span class="nav-link disabled">Hello, @username!</span>
                </li>
                <li class="nav-item">
                    <button class="btn btn-link nav-link" @onclick="Logout">Logout</button>
                </li>
            }
            else
            {
                <li class="nav-item">
                    <NavLink class="nav-link" href="login">Login</NavLink>
                </li>
            }
        </ul>
    </div>
</nav>

@code {
    private bool collapseNavMenu = true;
    private bool isLoggedIn = false;
    private string? username;

    protected override async Task OnInitializedAsync()
    {
        username = await localStorage.GetItemAsync<string>(Constants.authtoken);
        isLoggedIn = !string.IsNullOrEmpty(username);
    }

    private void ToggleNavMenu()
    {
        collapseNavMenu = !collapseNavMenu;
    }

    private async Task Logout()
    {
        await localStorage.RemoveItemAsync(Constants.authtoken);
        NavigationManager.NavigateTo("login", forceLoad: true);
    }
}